# 資料保存アプリ 実装プラン

## 1. 開発方針
- 現行ソリューションの課題を是正しつつ、要求機能を満たす新規コードベースを構築する
- 設計・設定・テストを早期から並行整備し、独立タスクでの開発を可能にする
- 設定値や依存関係を外部化し、環境差異に強い構成を採用する
- 開発成果は段階的に統合し、ドキュメントとテストを都度更新する

## 2. 独立タスク一覧
| タスクID | タスク名 | 目的 | 主な作業 | 成果物 | 依存関係 |
|----------|----------|------|----------|--------|----------|
| APP-01 | ドキュメント体系整備 | 情報の最新化と共有性向上 | docs 配下 Markdown の UTF-8 化<br>README にセットアップ手順追記<br>アーキテクチャ資料更新 | 更新済ドキュメント | なし |
| APP-02 | 設定外部化基盤 | 環境依存値の排除 | `appsettings.json` 初期スキーマ設計<br>設定読み込みサービス実装<br>ユーザー上書き設定フロー策定 | 設定ファイル・Configuration 層 | なし |
| APP-03 | コアアーキテクチャ設計 | 新構成の基礎確立 | ソリューション再編（WinExe 化）<br>層構造/フォルダ構成定義<br>DI ポイント設計 | 新 `.sln` と雛形コード | なし |
| APP-04 | ドメイン層再実装 | ドメインモデルの整理・刷新 | 現行 XML スキーマ調査<br>エンティティ / 値オブジェクト再設計<br>ドメインサービス整備 | `DocumentManager.Domain` | APP-03 |
| APP-05 | アプリケーション層実装 | ユースケースロジックの実装 | 資料登録・チェック更新フロー作成<br>DTO/ファサード層実装<br>整合性検証サービス組込 | `DocumentManager.AppServices` | APP-03, APP-04 |
| APP-06 | UI 層刷新 | UX 改善と機能統合 | WinForms 画面再設計<br>ViewModel / Presenter 展開<br>キャプチャ機能統合 | 新 UI プロジェクト | APP-03, APP-05 |
| APP-07 | ログ・例外処理基盤 | 信頼性・運用性向上 | グローバル例外ハンドラ実装<br>Serilog 等でのログ出力整備<br>ユーザー通知 UX 改善 | ログ設定、通知機構 | APP-03 |
| APP-08 | データ整合性監視 | 資料との同期を強化 | FileSystemWatcher 導入<br>検証ロジック再構築<br>UI での警告／修復導線整備 | 監視サービス・UI 表示 | APP-05, APP-06 |
| APP-09 | テスト自動化基盤 | 品質保証と回帰防止 | ドメイン／サービス層の単体テスト<br>主要ユースケースのシナリオテスト<br>CI 実行スクリプト作成 | テストプロジェクト・CI 設定 | APP-04～APP-06 |
| APP-10 | データ移行計画 | 既存データの継承 | 旧 XML スキーマ解析<br>移行ツール／手順策定<br>リハーサル検証 | 移行スクリプト・手順書 | APP-04, APP-05 |

## 3. タスク進行のガイドライン
- 各タスクは専用ブランチで開発し、成果物・テスト結果・ドキュメント更新を同梱する
- タスク完了時にレビュー指標（完了条件チェックリスト、テスト結果、既知課題）を提示する
- 並行タスク間で依存が生じる場合はスタブや契約インターフェースを取り決めて独立性を担保する
- マージ順序は `APP-01 → APP-03 → APP-04/05/07 → APP-06 → APP-08/09 → APP-10` を基本とし、必要に応じて調整する

## 4. 想定マイルストーン
| フェーズ | 期間目安 | 完了条件 |
|----------|----------|----------|
| 準備 | 1 週 | APP-01, APP-02, APP-03 完了。新構成・設定基盤が整備されている |
| ドメイン確立 | 2 週 | APP-04, APP-05 完了。主要ユースケースが CLI などで通る状態 |
| UI/運用基盤 | 2 週 | APP-06, APP-07 完了。UI プロトタイプとログ基盤が連携 |
| 強化 | 2 週 | APP-08, APP-09 完了。監視と自動テストが実装 |
| 移行準備 | 1 週 | APP-10 完了。旧データ移行手順とリハーサル結果を確定 |

## 5. リスクと対応策
| リスク | 内容 | 対応策 |
|--------|------|--------|
| 既存仕様の抜け漏れ | 現行実装の挙動を把握できず機能差異が発生 | ユースケース仕様・現行コードを参照し振る舞いを記録。差分は仕様変更として合意 |
| 依存関係の複雑化 | 新構成でも依存が肥大化する可能性 | 依存逆転原則と疎結合の原則を適用。レビューで循環依存をチェック |
| データ互換性 | 旧 XML との互換を保てない | APP-10 で移行ツールとバリデーションを用意し、段階的リリース前に検証 |
| 工数超過 | 並行タスクの調整コスト増 | タスク独立性を維持し、定期的な進捗確認と優先度見直しを実施 |

## 6. レビューと品質保証
- コードレビュー: GitHub Pull Request ベースで最低 2 名の承認を必須とする想定
- テスト: APP-09 で整備した自動テストを全タスクで必須実行。UI 改修時はスクリーンショットや録画を添付
- ドキュメント更新: タスク完了時に関連ドキュメントを更新し、要件とのトレーサビリティを維持
- リリース判定: マイルストーン毎に品質ゲート（テストパス率、重大バグ件数、ドキュメント整備状況）を確認

## 7. 引き継ぎと運用準備
- 運用手順書・FAQ を APP-07/APP-10 の成果物として整備し、利用者トレーニングを実施
- ログ解析手順と障害対応フローをまとめ、メンテナンス担当へ共有
- リリース後も課題管理票で改善項目をトラッキングし、次期フェーズ計画に反映