# CheckItemUIBuilderリファクタリング 手動テスト手順書

**作成日**: 2025-11-28
**対象**: チケット#009 統合テストとリグレッションテスト

---

## 事前準備

### 1. アプリケーションのビルドと起動

```powershell
# プロジェクトディレクトリに移動
cd C:\Users\ken-katayama\source\repos\DocumentFileManager

# ビルド
dotnet build src/DocumentFileManager.UI/DocumentFileManager.UI.csproj

# 起動
dotnet run --project src/DocumentFileManager.UI/DocumentFileManager.UI.csproj
```

### 2. テストデータの準備

- テスト用のドキュメントを1つ以上登録しておく
- チェック項目が複数あることを確認

### 3. DB確認ツール（オプション）

SQLiteのDBを確認したい場合:
- **DB Browser for SQLite**: https://sqlitebrowser.org/
- DBファイル: `src/DocumentFileManager.UI/workspace.db`

---

## テストシナリオ

### シナリオ 1: チェックON → キャプチャ取得 → 正常保存

**目的**: 基本的なチェックONとキャプチャ保存が正常に動作することを確認

**手順**:
1. MainWindowで任意のドキュメントを選択
2. 「チェックリスト」ボタンをクリックしてChecklistWindowを開く
3. **未チェック**の項目を探す
4. チェックボックスをクリック（ONにする）
5. 「キャプチャしますか？」ダイアログで「はい」を選択
6. 画面上で範囲を選択してキャプチャを保存

**期待結果**:
- [x] チェックボックスがON状態になる
- [ ] カメラボタン（📷）が表示される
- [x] UIがフリーズしない（操作可能）
- [x] チェックボックスのON表示が即座に反映される（1秒以内）

**結果**: [ ] Pass / [x] Fail

**備考**:

---

### シナリオ 2: チェックON → キャプチャなし

**目的**: キャプチャせずにチェックONできることを確認

**手順**:
1. ChecklistWindowを開く
2. **未チェック**の項目を探す
3. チェックボックスをクリック（ONにする）
4. 「キャプチャしますか？」ダイアログで「いいえ」を選択

**期待結果**:
- [x] チェックボックスがON状態になる
- [x] カメラボタン（📷）は表示されない
- [x] UIがフリーズしない

**結果**: [x] Pass / [ ] Fail

**備考**:

---

### シナリオ 3: 既存キャプチャの復帰

**目的**: 以前キャプチャしたデータを復帰できることを確認

**前提条件**: シナリオ1でキャプチャを保存済みの項目が必要

**手順**:
1. シナリオ1を実行してキャプチャを保存
2. そのチェックボックスをOFFにする
3. 再度チェックボックスをONにする
4. 「以前のキャプチャを復帰しますか？」ダイアログで「はい」を選択

**期待結果**:
- [x] チェックボックスがON状態になる
- [x] カメラボタン（📷）が表示される
- [x] 以前のキャプチャが復帰される

**結果**: [ ] Pass / [x] Fail

**備考**:
「はい」を選択したあと一度チェック、カメラボタンが消える。再度クリックしてキャンセルすると復帰する
---

### シナリオ 4: チェックOFF → キャプチャ維持

**目的**: チェックOFF時にキャプチャが破棄されないことを確認

**前提条件**: シナリオ1でキャプチャを保存済みの項目が必要

**手順**:
1. キャプチャあり・チェックONの項目を探す（またはシナリオ1を実行）
2. チェックボックスをOFFにする

**期待結果**:
- [x] チェックボックスがOFF状態になる
- [x] カメラボタン（📷）が非表示になる
- [x] キャプチャファイルは削除されない（シナリオ3で復帰可能）

**結果**: [x] Pass / [ ] Fail

**備考**:

---

### シナリオ 5: MainWindowでチェックボックス無効化

**目的**: MainWindowではチェック状態を変更できないことを確認

**手順**:
1. MainWindowを開く
2. ドキュメントを選択してチェック項目を表示
3. チェックボックスをクリックしようとする

**期待結果**:
- [x] チェックボックスが無効化（グレーアウト）されている
- [x] クリックしても反応しない（状態が変わらない）
- [x] キャプチャがある項目にはカメラボタン（📷）が表示される

**結果**: [x] Pass / [ ] Fail

**備考**:

---

### シナリオ 6: カメラボタンクリックで画像表示

**目的**: カメラボタンから画像を表示できることを確認

**前提条件**: キャプチャ保存済みの項目が必要

**手順**:
1. ChecklistWindowを開く
2. カメラボタン（📷）が表示されている項目を探す
3. カメラボタンをクリック

**期待結果**:
- [x] CaptureImageViewerWindowが開く
- [x] 保存済みのキャプチャ画像が表示される

**追加テスト（画像削除）**:
1. ビューワーで「削除」ボタンをクリック
2. 確認ダイアログで「はい」を選択

**期待結果**:
- [x] 画像ファイルが削除される
- [x] カメラボタン（📷）が非表示になる

**結果**: [ ] Pass / [x] Fail

**備考**:
表示はされるが、表示後チェックボックスとカメラボタンが消える
---

### シナリオ 7: async/await競合の解消（最重要）

**目的**: UIの描画遅延・フリーズが解消されていることを確認

**手順**:
1. ChecklistWindowを開く
2. 未チェックの項目のチェックボックスをONにする
3. キャプチャダイアログで「はい」を選択
4. キャプチャを保存

**確認ポイント**:
- [x] チェックボックスのON表示が**即座に**反映される（1秒以内）
- [x] カメラボタンの表示が**即座に**反映される（1秒以内）
- [ ] DB保存中にUIが**フリーズしない**（他の操作が可能）
- [x] ダイアログ表示がスムーズ

**比較テスト（複数回実行）**:
1. 上記手順を3回繰り返す
2. 毎回同じ動作になることを確認

**結果**: [ ] Pass / [x] Fail

**備考**:
DB保存のタイミングが不明。フリーズはしていないが判断できない

---

### シナリオ 8: 既存キャプチャの破棄

**目的**: 復帰確認で「いいえ」を選択したときの動作を確認

**前提条件**: シナリオ4実行後の項目（チェックOFF、キャプチャあり）

**手順**:
1. チェックOFF・キャプチャありの項目を探す
2. チェックボックスをONにする
3. 「以前のキャプチャを復帰しますか？」ダイアログで「いいえ」を選択

**期待結果**:
- [x] チェックボックスがON状態になる
- [x] カメラボタン（📷）は表示されない
- [x] 以前のキャプチャは破棄される

**結果**: [x] Pass / [ ] Fail

**備考**:

---

### シナリオ 9: 既存キャプチャ復帰のキャンセル

**目的**: 復帰確認で「キャンセル」を選択したときの動作を確認

**前提条件**: シナリオ4実行後の項目（チェックOFF、キャプチャあり）

**手順**:
1. チェックOFF・キャプチャありの項目を探す
2. チェックボックスをONにする
3. 「以前のキャプチャを復帰しますか？」ダイアログで「キャンセル」を選択

**期待結果**:
- [ ] チェックボックスがOFF状態に**戻る**（ロールバック）
- [ ] カメラボタン（📷）は表示されない
- [ ] DBは変更されない

**結果**: □ Pass / □ Fail

**備考**:

---

## テスト結果サマリー

| シナリオ | 説明 | 結果 |
|----------|------|------|
| 1 | チェックON → キャプチャ取得 → 正常保存 | □ Pass / □ Fail |
| 2 | チェックON → キャプチャなし | □ Pass / □ Fail |
| 3 | 既存キャプチャの復帰 | □ Pass / □ Fail |
| 4 | チェックOFF → キャプチャ維持 | □ Pass / □ Fail |
| 5 | MainWindowでチェックボックス無効化 | □ Pass / □ Fail |
| 6 | カメラボタンクリックで画像表示 | □ Pass / □ Fail |
| 7 | async/await競合の解消 | □ Pass / □ Fail |
| 8 | 既存キャプチャの破棄 | □ Pass / □ Fail |
| 9 | 既存キャプチャ復帰のキャンセル | □ Pass / □ Fail |

**総合結果**: □ 全Pass / □ 一部Fail

---

## 不具合報告テンプレート

不具合が見つかった場合は、以下の形式で記録してください。

```
### 不具合 #XX

**シナリオ**: シナリオX
**手順**:
1. ...
2. ...

**期待結果**:
...

**実際の結果**:
...

**スクリーンショット**:
（必要に応じて添付）

**ログ**:
（エラーログがあれば記載）

**優先度**: High / Medium / Low
```

---

## トラブルシューティング

### アプリケーションが起動しない

```powershell
# クリーンビルド
dotnet clean src/DocumentFileManager.UI/DocumentFileManager.UI.csproj
dotnet build src/DocumentFileManager.UI/DocumentFileManager.UI.csproj
```

### DBの状態をリセットしたい

```powershell
# DBファイルを削除（アプリケーション終了後）
Remove-Item src/DocumentFileManager.UI/workspace.db -ErrorAction SilentlyContinue
```

### ログを確認したい

アプリケーションのログはコンソールに出力されます。
`dotnet run` で起動すると、コンソールにログが表示されます。

---

## テスト実施記録

**テスト実施日**: ____年__月__日
**テスト実施者**: __________
**環境**: Windows __ / .NET __

**コメント**:


