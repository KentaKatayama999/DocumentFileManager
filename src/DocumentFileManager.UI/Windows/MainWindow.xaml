<Window x:Class="DocumentFileManager.UI.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DocumentFileManager.UI"
        xmlns:converters="clr-namespace:DocumentFileManager.UI.Converters"
        xmlns:vm="clr-namespace:DocumentFileManager.UI.ViewModels"
        xmlns:behaviors="clr-namespace:DocumentFileManager.UI.Behaviors"
        mc:Ignorable="d"
        Title="資料保存アプリ - Document File Manager"
        Height="600" Width="900"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converters:FileExtensionToIconConverter x:Key="FileExtensionToIconConverter"/>

        <!-- CheckBoxのスタイル（MainWindow用：読み取り専用表示） -->
        <Style x:Key="CheckItemCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Margin" Value="0,0,5,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <!-- カメラボタンのスタイル -->
        <Style x:Key="CameraButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24" />
            <Setter Property="Height" Value="20" />
            <Setter Property="Margin" Value="5,0,0,0" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="ToolTip" Value="キャプチャ画像を表示" />
            <Setter Property="Background">
                <Setter.Value>
                    <SolidColorBrush Color="#FFDCDC" />
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <SolidColorBrush Color="#C8A0A0" />
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Padding" Value="1" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
        </Style>

        <!-- CheckItemのDataTemplate（MainWindow用: クリックでフィルタリング、チェック状態は変更しない） -->
        <DataTemplate x:Key="CheckItemTemplate" DataType="{x:Type vm:CheckItemViewModel}">
            <StackPanel Orientation="Horizontal" Margin="2"
                        Background="{Binding Background, RelativeSource={RelativeSource AncestorType=ContentControl}}">
                <!-- チェックボックス（クリック時にSelectCommandを実行、チェック状態は変更しない） -->
                <CheckBox Content="{Binding Label}"
                          IsChecked="{Binding IsChecked, Mode=OneWay}"
                          IsEnabled="True"
                          behaviors:CheckBoxBehaviors.ClickCommand="{Binding SelectCommand}"
                          Style="{StaticResource CheckItemCheckBoxStyle}" />

                <!-- カメラボタン -->
                <Button Content="📷"
                        Visibility="{Binding CameraButtonVisibility}"
                        Command="{Binding ViewCaptureCommand}"
                        Style="{StaticResource CameraButtonStyle}" />
            </StackPanel>
        </DataTemplate>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- メニューバー -->
        <Menu Grid.Row="0">
            <MenuItem Header="ファイル(_F)">
                <MenuItem Header="終了(_X)" Click="ExitMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="ツール(_T)">
                <MenuItem Header="データ整合性チェック(_I)" Click="IntegrityCheckMenuItem_Click" InputGestureText="Ctrl+Shift+I"/>
            </MenuItem>
            <MenuItem Header="設定(_S)">
                <MenuItem Header="UI設定(_U)" Click="SettingsMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="チェックリスト切替(_C)" Click="SwitchChecklistMenuItem_Click"/>
                <MenuItem Header="チェックリストエディター(_E)" Click="ChecklistEditorMenuItem_Click"/>
                <MenuItem Header="新規チェックリスト作成(_N)" Click="CreateNewChecklistMenuItem_Click"/>
            </MenuItem>
        </Menu>

        <!-- タイトルバー -->
        <Border Grid.Row="1" Background="#2C3E50" Padding="15">
            <TextBlock Text="資料保存アプリ"
                       Foreground="White"
                       FontSize="20"
                       FontWeight="Bold"/>
        </Border>

        <!-- メインコンテンツエリア -->
        <Grid Grid.Row="2" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="200"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- 左側：資料一覧 -->
            <GroupBox Grid.Column="0" Header="資料一覧" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Margin="5">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="AddDocumentButton"
                                    Content="資料追加"
                                    Padding="10,5"
                                    Margin="0,0,5,0"
                                    Click="AddDocumentButton_Click"/>
                            <Button x:Name="ShowAllDocumentsButton"
                                    Content="すべて表示"
                                    Padding="10,5"
                                    Margin="0,0,5,0"
                                    Click="ShowAllDocumentsButton_Click"/>
                            <TextBlock x:Name="DocumentCountText"
                                       VerticalAlignment="Center"
                                       Text="0 件"/>
                        </StackPanel>
                        <TextBlock Text="※ 右クリックで「開く」「プログラムから開く」「削除」が選択できます"
                                   Foreground="Gray"
                                   FontSize="11"
                                   Margin="0,5,0,0"/>
                    </StackPanel>

                    <ListView x:Name="DocumentsListView"
                              Grid.Row="1"
                              Margin="5"
                              AllowDrop="True"
                              DragEnter="DocumentsListView_DragEnter"
                              Drop="DocumentsListView_Drop"
                              MouseDoubleClick="DocumentsListView_MouseDoubleClick"
                              SelectionChanged="DocumentsListView_SelectionChanged">
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="開く(_O)" Click="OpenDocumentMenuItem_Click"/>
                                <MenuItem Header="プログラムから開く(_P)..." Click="OpenWithMenuItem_Click"/>
                                <Separator/>
                                <MenuItem Header="削除(_D)" Click="DeleteDocumentMenuItem_Click"/>
                            </ContextMenu>
                        </ListView.ContextMenu>
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="ファイル名" Width="280">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Image Source="{Binding FileType, Converter={StaticResource FileExtensionToIconConverter}}"
                                                       Width="16" Height="16"
                                                       Margin="0,0,5,0"
                                                       VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding FileName}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="追加日時" Width="140" DisplayMemberBinding="{Binding AddedAt, StringFormat={}{0:yyyy/MM/dd HH:mm}}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </GroupBox>

            <!-- 区切り -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- 右側：チェック項目一覧（階層表示） -->
            <GroupBox Grid.Column="2" Header="チェック項目" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <TextBlock x:Name="CheckItemCountText"
                                   VerticalAlignment="Center"
                                   Text="0 件"/>
                    </StackPanel>

                    <!-- ScrollViewer + WrapPanel でGroupBox階層を表示 -->
                    <ScrollViewer Grid.Row="1"
                                  Margin="5"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  CanContentScroll="False"
                                  PanningMode="VerticalOnly">
                        <WrapPanel x:Name="CheckItemsContainer"
                                   Orientation="Horizontal"
                                   MouseLeftButtonDown="CheckItemsContainer_MouseLeftButtonDown"/>
                    </ScrollViewer>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- ステータスバー -->
        <Border Grid.Row="3" Background="#ECF0F1" Padding="10,5" BorderBrush="#BDC3C7" BorderThickness="0,1,0,0">
            <TextBlock x:Name="StatusText" Text="準備完了"/>
        </Border>
    </Grid>
</Window>
